
# 微前端

## 什么是微前端？

微前端是一种架构模式，它将单体应用程序拆分为多个小型前端应用程序。每个应用程序都是独立的，可以独立开发、部署和扩展。它们可以使用任何技术栈，但是它们都是通过一个主应用程序进行协调。

微前端的核心在于**独立开发、独立部署**。先拆分再合并，实现分而治之

## 微前端可以解决什么问题？

1. 不同团队使用不同的技术栈开发，但是又同时在开发一个应用
2. 每个团队的模块都可以独立开发、独立部署
3. 实现增量迁移（旧的应用可以和新的应用共存）

## 如何实现微前端

把一个应用拆分成若干个子应用，将每一个子应用打包成一个个的模块。当路径切换时加载不同的子应用。这样每个子应用都是相互独立的，技术栈也可以不做限制了。**从而解决了不同团队使用不同技术栈开发的问题**

### 微前端实现技术方案

实现微前端需要考虑几个问题：

1. 采用什么方案进行拆分
2. 使用什么方式进行通信
3. 应用之间如何进行隔离

#### 1. iframe

- 微前端最简单的方案，通过 iframe 嵌入子应用
- 通信：通过`postMessage`进行通信
- 隔离：完美的沙箱机制，自带隔离

> 缺点: 用户体验差，弹框只能在iframe中，在内部切换刷新，就会丢失，性能差

#### 2. Web Component

- 将前端应用拆分成一个个的 `Web Component`，分解成自定义HTML元素
- 通信：基于`CustomEvent`进行通信
- 隔离：通过`Shadow DOM`进行隔离

> 缺点：兼容性差，不支持IE，学习成本高，调试困难，修改样式需要修改源码

#### 3. Single SPA

- `single-spa`是一个微前端框架，通过路由劫持来实现应用加载（采用SystemJs）,提供应用间公共组件加载及公共业务逻辑处理。**子应用需要暴露固定的钩子函数，比如bootstarp、mount、unmount**
- 通信：基于`props`主子应用间通信
- 隔离：无沙箱机制，需要自己实现JS沙箱和CSS沙箱
  
> 缺点：学习成本高，无沙箱机制，需要对原有的应用进行改造，子应用间相同资源重复加载问题

#### 4. module federation

- `module federation`是webpack5新增的功能，可以实现多个应用之间的共享模块，实现了应用间的通信和隔离
- 通信：共享模块的方式实现通信
- 隔离：无沙箱机制

> 缺点：webpack5才支持，需要对原有的应用进行改造
