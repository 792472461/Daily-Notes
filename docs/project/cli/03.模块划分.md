# 模块划分

## 引入lerna

虽然lerna不维护了，但是还是一个比较好的库管理库

lerna是用于管理具有多个包的 JavaScript 项目的工具。

lerna初始化过程
1. 安装learn: yarn add -D lerna
2. npx lerna init
```
lerna notice cli v4.0.0
lerna info Updating package.json
lerna info Creating lerna.json
lerna info Creating packages directory
lerna success Initialized Lerna files
```
3. 创建模块: lerna crete xxx
4. 安装依赖: lerna add xxx
5. 重新安装依赖: lerna bootstarp

## 拆包
- 核心流程: core
- 命令: command
  - 初始化
  - 发布
  - 清除缓存
- 模型层 models
  - command命令
  - project项目
  - component组件
  - npm模块
  - git仓库
- 支撑模块 utils
  - git操作
  - 云构建
  - 工具方法
  - api请求

### core 模块

#### 命令行执行流程

- 准备阶段
  - 检查版本号
  - 检查node版本
  - 检查是否是root启动
  - 检查用户主目录
  - 检查入参
  - 检查环境变量
  - 检查是否为新版本 -> 提示更新 
- 命令注册
  - 注册init命令
  - 注册publish命令
  - 注册clean命令
  - 支持debug模式
- 命令执行
 

#### 涉及技术点

> 核心库：
- commander

> 工具库
- npmlog 日志打印
- fs-extra 文件库
- semver 版本库对比
- colors 颜色
- user-home 检查是否是用户主目录
- dotenv
- root-check 权限降级